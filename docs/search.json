[
  {
    "objectID": "HW8_Costello.html",
    "href": "HW8_Costello.html",
    "title": "Homework 8: Basic Modeling Practice",
    "section": "",
    "text": "Seoul Bike Sharing Demand Dataset\n\nlibrary(readr)\nlibrary(broom)\nlibrary(lubridate)\n\n\nAttaching package: 'lubridate'\n\n\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n\nlibrary(janitor)\n\n\nAttaching package: 'janitor'\n\n\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n\nlibrary(dplyr)\n\n\nAttaching package: 'dplyr'\n\n\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n\n\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n\nlibrary(ggplot2)\nlibrary(GGally)\nlibrary(tidymodels)\n\nWarning: package 'tidymodels' was built under R version 4.5.2\n\n\n── Attaching packages ────────────────────────────────────── tidymodels 1.4.1 ──\n\n\n✔ dials        1.4.2     ✔ tailor       0.1.0\n✔ infer        1.0.9     ✔ tidyr        1.3.1\n✔ modeldata    1.5.1     ✔ tune         2.0.1\n✔ parsnip      1.3.3     ✔ workflows    1.3.0\n✔ purrr        1.1.0     ✔ workflowsets 1.1.1\n✔ recipes      1.3.1     ✔ yardstick    1.3.2\n✔ rsample      1.3.1     \n\n\nWarning: package 'dials' was built under R version 4.5.2\n\n\nWarning: package 'infer' was built under R version 4.5.2\n\n\nWarning: package 'modeldata' was built under R version 4.5.2\n\n\nWarning: package 'parsnip' was built under R version 4.5.2\n\n\nWarning: package 'recipes' was built under R version 4.5.2\n\n\nWarning: package 'rsample' was built under R version 4.5.2\n\n\nWarning: package 'tailor' was built under R version 4.5.2\n\n\nWarning: package 'tune' was built under R version 4.5.2\n\n\nWarning: package 'workflows' was built under R version 4.5.2\n\n\nWarning: package 'workflowsets' was built under R version 4.5.2\n\n\nWarning: package 'yardstick' was built under R version 4.5.2\n\n\n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ purrr::discard()  masks scales::discard()\n✖ dplyr::filter()   masks stats::filter()\n✖ dplyr::lag()      masks stats::lag()\n✖ yardstick::spec() masks readr::spec()\n✖ recipes::step()   masks stats::step()\n\n\nThe following data set is provided by the UCI Machine Learning Repository. The data set contains count of public bicycles rented per hours in the Seoul Bike Sharing System, with corresponding weather data and holiday information.\nThe following variables are provided:\n\nDate - day/month/year\nRented Bike count - Count of bikes rented at each hour\nHour - Hour of the day\nTemperature-Temperature in Celsius\nHumidity - %\nWindspeed - m/s\nVisibility - 10m\nDew point temperature - Celsius\nSolar radiation - MJ/m2\nRainfall - mm\nSnowfall - cm\nSeasons - Winter, Spring, Summer, Autumn\nHoliday - Holiday/No holiday\nFunctional Day - NoFunc(Non Functional Hours), Fun(Functional hours)\n\n\n# Read in data\nbike_data &lt;- read_csv(\"SeoulBikeData.csv\", locale = locale(encoding = \"latin1\"))\n\nRows: 8760 Columns: 14\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (4): Date, Seasons, Holiday, Functioning Day\ndbl (10): Rented Bike Count, Hour, Temperature(°C), Humidity(%), Wind speed ...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\n\nEDA\nBefore we summarize the data, let’s determine if the data set contains any missing values.\n\n# check for missing values\ncolSums(is.na(bike_data))\n\n                     Date         Rented Bike Count                      Hour \n                        0                         0                         0 \n          Temperature(°C)               Humidity(%)          Wind speed (m/s) \n                        0                         0                         0 \n         Visibility (10m) Dew point temperature(°C)   Solar Radiation (MJ/m2) \n                        0                         0                         0 \n             Rainfall(mm)             Snowfall (cm)                   Seasons \n                        0                         0                         0 \n                  Holiday           Functioning Day \n                        0                         0 \n\n\nThe data provided does not contain any missing values.\nThe following contains the structure of the data set, so we can see the different variables and how they are being stored.\n\nstr(bike_data)\n\nspc_tbl_ [8,760 × 14] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ Date                     : chr [1:8760] \"01/12/2017\" \"01/12/2017\" \"01/12/2017\" \"01/12/2017\" ...\n $ Rented Bike Count        : num [1:8760] 254 204 173 107 78 100 181 460 930 490 ...\n $ Hour                     : num [1:8760] 0 1 2 3 4 5 6 7 8 9 ...\n $ Temperature(°C)          : num [1:8760] -5.2 -5.5 -6 -6.2 -6 -6.4 -6.6 -7.4 -7.6 -6.5 ...\n $ Humidity(%)              : num [1:8760] 37 38 39 40 36 37 35 38 37 27 ...\n $ Wind speed (m/s)         : num [1:8760] 2.2 0.8 1 0.9 2.3 1.5 1.3 0.9 1.1 0.5 ...\n $ Visibility (10m)         : num [1:8760] 2000 2000 2000 2000 2000 ...\n $ Dew point temperature(°C): num [1:8760] -17.6 -17.6 -17.7 -17.6 -18.6 -18.7 -19.5 -19.3 -19.8 -22.4 ...\n $ Solar Radiation (MJ/m2)  : num [1:8760] 0 0 0 0 0 0 0 0 0.01 0.23 ...\n $ Rainfall(mm)             : num [1:8760] 0 0 0 0 0 0 0 0 0 0 ...\n $ Snowfall (cm)            : num [1:8760] 0 0 0 0 0 0 0 0 0 0 ...\n $ Seasons                  : chr [1:8760] \"Winter\" \"Winter\" \"Winter\" \"Winter\" ...\n $ Holiday                  : chr [1:8760] \"No Holiday\" \"No Holiday\" \"No Holiday\" \"No Holiday\" ...\n $ Functioning Day          : chr [1:8760] \"Yes\" \"Yes\" \"Yes\" \"Yes\" ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   Date = col_character(),\n  ..   `Rented Bike Count` = col_double(),\n  ..   Hour = col_double(),\n  ..   `Temperature(°C)` = col_double(),\n  ..   `Humidity(%)` = col_double(),\n  ..   `Wind speed (m/s)` = col_double(),\n  ..   `Visibility (10m)` = col_double(),\n  ..   `Dew point temperature(°C)` = col_double(),\n  ..   `Solar Radiation (MJ/m2)` = col_double(),\n  ..   `Rainfall(mm)` = col_double(),\n  ..   `Snowfall (cm)` = col_double(),\n  ..   Seasons = col_character(),\n  ..   Holiday = col_character(),\n  ..   `Functioning Day` = col_character()\n  .. )\n - attr(*, \"problems\")=&lt;externalptr&gt; \n\n\nBelow is a summary of basic stats that can be used to make sure the data makes sense.\n\nsummary(bike_data)\n\n     Date           Rented Bike Count      Hour       Temperature(°C) \n Length:8760        Min.   :   0.0    Min.   : 0.00   Min.   :-17.80  \n Class :character   1st Qu.: 191.0    1st Qu.: 5.75   1st Qu.:  3.50  \n Mode  :character   Median : 504.5    Median :11.50   Median : 13.70  \n                    Mean   : 704.6    Mean   :11.50   Mean   : 12.88  \n                    3rd Qu.:1065.2    3rd Qu.:17.25   3rd Qu.: 22.50  \n                    Max.   :3556.0    Max.   :23.00   Max.   : 39.40  \n  Humidity(%)    Wind speed (m/s) Visibility (10m) Dew point temperature(°C)\n Min.   : 0.00   Min.   :0.000    Min.   :  27     Min.   :-30.600          \n 1st Qu.:42.00   1st Qu.:0.900    1st Qu.: 940     1st Qu.: -4.700          \n Median :57.00   Median :1.500    Median :1698     Median :  5.100          \n Mean   :58.23   Mean   :1.725    Mean   :1437     Mean   :  4.074          \n 3rd Qu.:74.00   3rd Qu.:2.300    3rd Qu.:2000     3rd Qu.: 14.800          \n Max.   :98.00   Max.   :7.400    Max.   :2000     Max.   : 27.200          \n Solar Radiation (MJ/m2)  Rainfall(mm)     Snowfall (cm)       Seasons         \n Min.   :0.0000          Min.   : 0.0000   Min.   :0.00000   Length:8760       \n 1st Qu.:0.0000          1st Qu.: 0.0000   1st Qu.:0.00000   Class :character  \n Median :0.0100          Median : 0.0000   Median :0.00000   Mode  :character  \n Mean   :0.5691          Mean   : 0.1487   Mean   :0.07507                     \n 3rd Qu.:0.9300          3rd Qu.: 0.0000   3rd Qu.:0.00000                     \n Max.   :3.5200          Max.   :35.0000   Max.   :8.80000                     \n   Holiday          Functioning Day   \n Length:8760        Length:8760       \n Class :character   Class :character  \n Mode  :character   Mode  :character  \n                                      \n                                      \n                                      \n\n\n\nunique(bike_data$Seasons)\n\n[1] \"Winter\" \"Spring\" \"Summer\" \"Autumn\"\n\nunique(bike_data$Holiday)\n\n[1] \"No Holiday\" \"Holiday\"   \n\nunique(bike_data$`Functioning Day`)\n\n[1] \"Yes\" \"No\" \n\n\nUnique values for Seasons are Winter, Spring, Summer, and Autumn. The holiday variable value for an observation is either No Holiday or Holiday. The Functioning Day is either Yes or No (Yes, it is during functional hours or No, it is not).\nLet’s manipulate the data by:\n\nconverting the date column to an actual date.\nturning the character variables into factors (for the different levels/categories).\nrenaming all the variables to snake case.\n\n\nbike_data &lt;- bike_data |&gt;\n  mutate(\n     Date = dmy(Date),\n     Seasons = as.factor(Seasons),\n     Holiday = as.factor(Holiday),\n     `Functioning Day` = as.factor(`Functioning Day`)\n  ) |&gt;\n  clean_names(\"snake\")\n\nLet’s see how many observations occurred in each season during functional or non-functional hours. And let’s see how many observations occurred during a holiday vs no holiday during functional and non-functional hours.\n\n# Two-way contingency tables\ntable(bike_data$functioning_day, bike_data$seasons)\n\n     \n      Autumn Spring Summer Winter\n  No     247     48      0      0\n  Yes   1937   2160   2208   2160\n\ntable(bike_data$functioning_day, bike_data$holiday)\n\n     \n      Holiday No Holiday\n  No       24        271\n  Yes     408       8057\n\n\nThere are no observations in Summer and Winter that occurred during non-functional hours. Most observations are not on a holiday and during functional hours.\nLet’s look at the Mean and Median for all numeric variables during functional and non-functional hours.\n\nbike_data |&gt;\n  group_by(functioning_day) |&gt;\n  summarize(across(where(is.numeric), \n                   list(\"mean\" = mean, \"median\" = median), \n                   .names = \"{.fn}_{.col}\"))\n\n# A tibble: 2 × 21\n  functioning_day mean_rented_bike_count median_rented_bike_count mean_hour\n  &lt;fct&gt;                            &lt;dbl&gt;                    &lt;dbl&gt;     &lt;dbl&gt;\n1 No                                  0                         0      11.3\n2 Yes                               729.                      542      11.5\n# ℹ 17 more variables: median_hour &lt;dbl&gt;, mean_temperature_c &lt;dbl&gt;,\n#   median_temperature_c &lt;dbl&gt;, mean_humidity_percent &lt;dbl&gt;,\n#   median_humidity_percent &lt;dbl&gt;, mean_wind_speed_m_s &lt;dbl&gt;,\n#   median_wind_speed_m_s &lt;dbl&gt;, mean_visibility_10m &lt;dbl&gt;,\n#   median_visibility_10m &lt;dbl&gt;, mean_dew_point_temperature_c &lt;dbl&gt;,\n#   median_dew_point_temperature_c &lt;dbl&gt;, mean_solar_radiation_mj_m2 &lt;dbl&gt;,\n#   median_solar_radiation_mj_m2 &lt;dbl&gt;, mean_rainfall_mm &lt;dbl&gt;, …\n\n\nThe mean and median rented bike counts are zero during non-functional hours.\nTo confirm there are no bikes being rented during non-functional hours, let’s look at the min and max rental bike counts.\n\nbike_data |&gt;\n  group_by(functioning_day) |&gt;\n  summarize(min_bike_count = min(rented_bike_count), max_bike_count = max(rented_bike_count))\n\n# A tibble: 2 × 3\n  functioning_day min_bike_count max_bike_count\n  &lt;fct&gt;                    &lt;dbl&gt;          &lt;dbl&gt;\n1 No                           0              0\n2 Yes                          2           3556\n\n\nNo bikes were rented during non-functional hours.\nSince no bikes are being rented during non-functional hours, we can remove the observations that occurred during non-functional hours.\n\nfun_bike_data &lt;- bike_data |&gt;\n  filter(functioning_day == \"Yes\")\n\nTo simplify analysis, let’s summarize across the hours so each day has one observation with it. This can be done by grouping by character variables, and summarizing (either sum or mean) across numeric variables.\n\nbike_summary_data &lt;- fun_bike_data |&gt;\n  group_by(date, seasons, holiday) |&gt;\n  summarize(\n    sum_bike_count = sum(rented_bike_count),\n    sum_rainfall = sum(rainfall_mm),\n    sum_snowfall = sum(snowfall_cm),\n    across(c(temperature_c, \n             humidity_percent,\n             wind_speed_m_s,\n             visibility_10m,\n             dew_point_temperature_c,\n             solar_radiation_mj_m2), \n           ~ mean(.x),\n           .names = \"mean_{.col}\")\n    \n  )\n\n`summarise()` has grouped output by 'date', 'seasons'. You can override using\nthe `.groups` argument.\n\nhead(bike_summary_data)\n\n# A tibble: 6 × 12\n# Groups:   date, seasons [6]\n  date       seasons holiday    sum_bike_count sum_rainfall sum_snowfall\n  &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;               &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;\n1 2017-12-01 Winter  No Holiday           9539          0            0  \n2 2017-12-02 Winter  No Holiday           8523          0            0  \n3 2017-12-03 Winter  No Holiday           7222          4            0  \n4 2017-12-04 Winter  No Holiday           8729          0.1          0  \n5 2017-12-05 Winter  No Holiday           8307          0            0  \n6 2017-12-06 Winter  No Holiday           6669          1.3          8.6\n# ℹ 6 more variables: mean_temperature_c &lt;dbl&gt;, mean_humidity_percent &lt;dbl&gt;,\n#   mean_wind_speed_m_s &lt;dbl&gt;, mean_visibility_10m &lt;dbl&gt;,\n#   mean_dew_point_temperature_c &lt;dbl&gt;, mean_solar_radiation_mj_m2 &lt;dbl&gt;\n\n\nNow that non-functional hours have been removed from the data, let’s see the number of observations that occurred on a holiday or no holiday by the season.\n\ntable(bike_summary_data$seasons, bike_summary_data$holiday)\n\n        \n         Holiday No Holiday\n  Autumn       4         77\n  Spring       3         87\n  Summer       2         90\n  Winter       8         82\n\n\nLet’s get the mean and median of numeric variables without the non-functional hours observations, by seasons.\n\nbike_summary_data |&gt;\n  group_by(seasons) |&gt;\n  summarize(across(where(is.numeric), \n                   list(\"mean\" = mean, \"median\" = median), \n                   .names = \"{.fn}_{.col}\"))\n\n# A tibble: 4 × 19\n  seasons mean_sum_bike_count median_sum_bike_count mean_sum_rainfall\n  &lt;fct&gt;                 &lt;dbl&gt;                 &lt;dbl&gt;             &lt;dbl&gt;\n1 Autumn               22099.                23350              2.81 \n2 Spring               17910.                17590              4.49 \n3 Summer               24818.                25572.             6.08 \n4 Winter                5413.                 5498              0.788\n# ℹ 15 more variables: median_sum_rainfall &lt;dbl&gt;, mean_sum_snowfall &lt;dbl&gt;,\n#   median_sum_snowfall &lt;dbl&gt;, mean_mean_temperature_c &lt;dbl&gt;,\n#   median_mean_temperature_c &lt;dbl&gt;, mean_mean_humidity_percent &lt;dbl&gt;,\n#   median_mean_humidity_percent &lt;dbl&gt;, mean_mean_wind_speed_m_s &lt;dbl&gt;,\n#   median_mean_wind_speed_m_s &lt;dbl&gt;, mean_mean_visibility_10m &lt;dbl&gt;,\n#   median_mean_visibility_10m &lt;dbl&gt;, mean_mean_dew_point_temperature_c &lt;dbl&gt;,\n#   median_mean_dew_point_temperature_c &lt;dbl&gt;, …\n\n\nNot surprisingly, the most bike rentals occurred during the Summer, then Autumn.\nLet’s see the min and max daily bike rentals by season.\n\nbike_summary_data |&gt;\n  group_by(seasons) |&gt;\n  summarize(min_bike_count = min(sum_bike_count), max_bike_count = max(sum_bike_count))\n\n# A tibble: 4 × 3\n  seasons min_bike_count max_bike_count\n  &lt;fct&gt;            &lt;dbl&gt;          &lt;dbl&gt;\n1 Autumn            1721          31809\n2 Spring             977          31681\n3 Summer            3231          36149\n4 Winter            2014           9539\n\n\nLet’s generate a correlation matrix plot, so we can see the relationships between the numeric variables.\n\ndf_corr &lt;- bike_summary_data |&gt;\n  select(where(is.numeric)) |&gt;\n  rename(\"Bike_count\" = sum_bike_count,\n         \"Rainfall\" = sum_rainfall,\n         \"Snowfall\" = sum_snowfall,\n         \"Temperature\" = mean_temperature_c,\n         \"Humidity\" = mean_humidity_percent,\n         \"Windspeed\" = mean_wind_speed_m_s,\n         \"Visibility\" = mean_visibility_10m,\n         \"Dew_point\" = mean_dew_point_temperature_c,\n         \"Solar_radiation\" = mean_solar_radiation_mj_m2)\n\nAdding missing grouping variables: `date`, `seasons`\n\nggcorr(df_corr, \n       nbreaks = 6,\n       label = TRUE,\n       palette = \"BuPu\",\n       size = 2,          # adjusting variable names sizes\n       hjust = 0.65) +    # adjusting position of variable names) \n  labs(title = \"Correlation Matrix of all Numeric Variables\") +\n  ggeasy::easy_center_title()\n\nWarning: data in columns date and seasons are not numeric and were ignored\n\n\n\n\n\n\n\n\n\nWhen looking at daily bike rentals, temperature has the greatest positive correlation (the higher the temp, the higher the # of bike rentals). Humidity does not appear to have any relationship with bike rental counts.\n\ndf_corr |&gt;\n  group_by(seasons) |&gt;\n  summarize(correlation = cor(Bike_count, Temperature, use = \"pairwise.complete.obs\"))\n\n# A tibble: 4 × 2\n  seasons correlation\n  &lt;fct&gt;         &lt;dbl&gt;\n1 Autumn        0.538\n2 Spring        0.654\n3 Summer       -0.217\n4 Winter        0.471\n\n\nWhen looking at the relationship between bike counts and temperature across seasons, it’s surprising to see that summer has a slight negative correlation. Spring has a greater positive correlation between temperature and bike counts.\nLet’s see some plots to explore the data.\nScatterplot:\n\ng &lt;- ggplot(data = bike_summary_data)\n\ng + geom_point(aes(x = sum_bike_count, \n                   y = sum_rainfall, \n                   color = seasons)) +\n  labs(x = \"Rental Bike Count\", \n       y = \"Rainfall (mm)\",\n       title = \"Rental Bike Count by Total Daily Rainfall\",\n       color = \"Seasons\") +\n  scale_color_manual(values = c(\"#FFFF00\",\n                                \"#FF00FF\",\n                                \"#7FFF00\",\n                                \"#00FFFF\")) +\n  theme_dark() +\n  ggeasy::easy_center_title() \n\n\n\n\n\n\n\n\nIn the plot above, you can see rental bike counts vs rainfall. The points are also color coded by season. Bike rentals are greater in the summer, but there are fewer observations during heavy rainfall.\nBoxplot:\n\ng + geom_boxplot(aes(x = seasons, y = sum_bike_count, fill = holiday)) +\n  labs(x = \"Seasons\", \n       y = \"Daily Rental Bike Count\",\n       title = \"Daily Rental Bike Count by Seasons\",\n       fill = \"Holiday\") +\n  ggeasy::easy_center_title() +\n  scale_fill_manual(values = c(\"lightpink\",\n                               \"lightblue\"))\n\n\n\n\n\n\n\n\nIn the plot above, you can see that bike rental counts are greater in Summer and Autumn. Spring has a larger range of bike counts on a given day (greater distance between the min and max).\nScatterplot with a regression line:\n\nggplot(bike_summary_data, aes(x = date, y = sum_bike_count)) +\n  geom_point() +\n  labs(x = \"Date\", \n       y = \"Daily Rental Bike Count\",\n       title = \"Daily Rental Bike Count by Date\") +\n  ggeasy::easy_center_title() +\n  geom_smooth()\n\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n\n\n\n\n\n\n\n\n\nIn the plot above, you can see the trend of daily bike rentals by date, throughout 2018. Between June and July appear to have the most daily bike rentals, and January has the lowest.\n\n\nSplitting the Data\nSplit the data into training and test set.\n\n# Fix the random numbers by setting the seed \n# This enables the analysis to be reproducible when random numbers are used \nset.seed(123)\n# Put 3/4 of the data into the training set \ndata_split &lt;- initial_split(bike_summary_data, prop = 3/4, strata = seasons)\n\n# Create data frames for the two sets:\ntrain_data &lt;- training(data_split)\ntest_data  &lt;- testing(data_split)\n\nOn the training set, create a 10 fold cross validation split.\n\n# Create cross validation folds on the training data\nset.seed(234)\nbike_folds &lt;- vfold_cv(train_data, 10)\n\n\n\nFitting MLR Models\nLet’s create some recipes.\n\nrecipe_one &lt;- recipe(sum_bike_count ~ ., data = train_data) |&gt; \n  update_role(date, new_role = \"ID\") |&gt;\n  step_date(date, features = \"dow\") |&gt;\n  step_mutate(day_of_week = \n                as.factor(ifelse(date_dow %in% c(\"Sat\", \"Sun\"), \"weekend\", \"weekday\"))) |&gt;\n  step_rm(date_dow) |&gt;     #removes intermediate variable\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_dummy(seasons, holiday, day_of_week)\n\n\n# Same as recipe one except including interactions.\nrecipe_two &lt;- recipe(sum_bike_count ~ ., data = train_data) |&gt; \n  update_role(date, new_role = \"ID\") |&gt;\n  step_date(date, features = \"dow\") |&gt;\n  step_mutate(day_of_week = \n                as.factor(ifelse(date_dow %in% c(\"Sat\", \"Sun\"), \"weekend\", \"weekday\"))) |&gt;\n  step_rm(date_dow) |&gt;     #removes intermediate variable\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_dummy(seasons, holiday, day_of_week) |&gt;\n  step_interact(terms = ~starts_with(\"holiday\")*starts_with(\"seasons\") +\n                  ~mean_temperature_c*starts_with(\"seasons\") +\n                  ~mean_temperature_c*sum_rainfall)\n\n\n# Same as recipe two except adding quadratic terms to numeric predictors.\nrecipe_three &lt;- recipe(sum_bike_count ~ ., data = train_data) |&gt; \n  update_role(date, new_role = \"ID\") |&gt;\n  step_date(date, features = \"dow\") |&gt;\n  step_mutate(day_of_week = \n                as.factor(ifelse(date_dow %in% c(\"Sat\", \"Sun\"), \"weekend\", \"weekday\"))) |&gt;\n  step_rm(date_dow) |&gt;     #removes intermediate variable\n  step_normalize(all_numeric(), -all_outcomes()) |&gt;\n  step_dummy(seasons, holiday, day_of_week) |&gt;\n  step_interact(terms = ~starts_with(\"holiday\")*starts_with(\"seasons\") +\n                  ~mean_temperature_c*starts_with(\"seasons\") +\n                  ~mean_temperature_c*sum_rainfall) |&gt;\n  step_poly(starts_with(\"mean\"), sum_rainfall, sum_snowfall)\n\nNow, let’s set up our linear model fit to use the lm engine.\n\nbike_mod &lt;- linear_reg() |&gt;\n  set_engine(\"lm\")\n\nCombining recipes and model into workflows (for each recipe).\n\nworkflow_one &lt;- workflow() |&gt;\n  add_recipe(recipe_one) |&gt;\n  add_model(bike_mod)\n\nworkflow_two &lt;- workflow() |&gt;\n  add_recipe(recipe_two) |&gt;\n  add_model(bike_mod)\n\nworkflow_three &lt;- workflow() |&gt;\n  add_recipe(recipe_three) |&gt;\n  add_model(bike_mod)\n\nFit the models using the 10 fold CV.\n\nbike_CV_fit_one &lt;- workflow_one |&gt;\n  fit_resamples(bike_folds)\nbike_CV_fit_one\n\n# Resampling results\n# 10-fold cross-validation \n# A tibble: 10 × 4\n   splits           id     .metrics         .notes          \n   &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;          \n 1 &lt;split [236/27]&gt; Fold01 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 2 &lt;split [236/27]&gt; Fold02 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 3 &lt;split [236/27]&gt; Fold03 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 4 &lt;split [237/26]&gt; Fold04 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 5 &lt;split [237/26]&gt; Fold05 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 6 &lt;split [237/26]&gt; Fold06 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 7 &lt;split [237/26]&gt; Fold07 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 8 &lt;split [237/26]&gt; Fold08 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 9 &lt;split [237/26]&gt; Fold09 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n10 &lt;split [237/26]&gt; Fold10 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n\nbike_CV_fit_one |&gt;\n  collect_metrics()\n\n# A tibble: 2 × 6\n  .metric .estimator     mean     n  std_err .config        \n  &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;          \n1 rmse    standard   4103.       10 320.     pre0_mod0_post0\n2 rsq     standard      0.818    10   0.0311 pre0_mod0_post0\n\n\n\nbike_CV_fit_two &lt;- workflow_two |&gt;\n  fit_resamples(bike_folds)\n\n→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient=\"NA\")\n\n\nThere were issues with some computations   A: x1\nThere were issues with some computations   A: x1\n\n\n\n\nbike_CV_fit_two\n\n# Resampling results\n# 10-fold cross-validation \n# A tibble: 10 × 4\n   splits           id     .metrics         .notes          \n   &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;          \n 1 &lt;split [236/27]&gt; Fold01 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 2 &lt;split [236/27]&gt; Fold02 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 3 &lt;split [236/27]&gt; Fold03 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 4 &lt;split [237/26]&gt; Fold04 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 5 &lt;split [237/26]&gt; Fold05 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 6 &lt;split [237/26]&gt; Fold06 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 7 &lt;split [237/26]&gt; Fold07 &lt;tibble [2 × 4]&gt; &lt;tibble [1 × 4]&gt;\n 8 &lt;split [237/26]&gt; Fold08 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 9 &lt;split [237/26]&gt; Fold09 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n10 &lt;split [237/26]&gt; Fold10 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n\nThere were issues with some computations:\n\n  - Warning(s) x1: prediction from rank-deficient fit; consider predict(., rankdefic...\n\nRun `show_notes(.Last.tune.result)` for more information.\n\nbike_CV_fit_two |&gt;\n  collect_metrics()\n\n# A tibble: 2 × 6\n  .metric .estimator     mean     n  std_err .config        \n  &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;          \n1 rmse    standard   2996.       10 261.     pre0_mod0_post0\n2 rsq     standard      0.897    10   0.0218 pre0_mod0_post0\n\n\n\nbike_CV_fit_three &lt;- workflow_three |&gt;\n  fit_resamples(bike_folds)\n\n→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient=\"NA\")\n\n\nThere were issues with some computations   A: x1\nThere were issues with some computations   A: x1\n\n\n\n\nbike_CV_fit_three\n\n# Resampling results\n# 10-fold cross-validation \n# A tibble: 10 × 4\n   splits           id     .metrics         .notes          \n   &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;          \n 1 &lt;split [236/27]&gt; Fold01 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 2 &lt;split [236/27]&gt; Fold02 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 3 &lt;split [236/27]&gt; Fold03 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 4 &lt;split [237/26]&gt; Fold04 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 5 &lt;split [237/26]&gt; Fold05 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 6 &lt;split [237/26]&gt; Fold06 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 7 &lt;split [237/26]&gt; Fold07 &lt;tibble [2 × 4]&gt; &lt;tibble [1 × 4]&gt;\n 8 &lt;split [237/26]&gt; Fold08 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n 9 &lt;split [237/26]&gt; Fold09 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n10 &lt;split [237/26]&gt; Fold10 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt;\n\nThere were issues with some computations:\n\n  - Warning(s) x1: prediction from rank-deficient fit; consider predict(., rankdefic...\n\nRun `show_notes(.Last.tune.result)` for more information.\n\nbike_CV_fit_three |&gt;\n  collect_metrics()\n\n# A tibble: 2 × 6\n  .metric .estimator     mean     n  std_err .config        \n  &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;          \n1 rmse    standard   2921.       10 221.     pre0_mod0_post0\n2 rsq     standard      0.902    10   0.0190 pre0_mod0_post0\n\n\nModel 3 is the best fit (lowest RMSE and highest RSQ).\nUsing the “best” model, fit th emodel to the entire training data set.\n\nset.seed(123)\nbest_fit &lt;- \n  workflow_three |&gt;\n  last_fit(data_split)\n\nbest_fit |&gt;\n  collect_metrics()\n\n# A tibble: 2 × 4\n  .metric .estimator .estimate .config        \n  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          \n1 rmse    standard    2950.    pre0_mod0_post0\n2 rsq     standard       0.917 pre0_mod0_post0\n\n\nMake predictions on the test set and calculate RMSE.\n\ntest_fit &lt;- extract_workflow(best_fit)\nbike_predictions &lt;- predict(test_fit, new_data = test_data) |&gt;\n  bind_cols(test_data |&gt;\n              select(sum_bike_count))   #add the true values\n\nAdding missing grouping variables: `date`, `seasons`\n\nRMSE_test &lt;- bike_predictions |&gt;\n  rmse(truth = sum_bike_count, estimate = .pred)\nRMSE_test\n\n# A tibble: 1 × 3\n  .metric .estimator .estimate\n  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;\n1 rmse    standard       2950.\n\n\nObtain the final model coefficient table.\n\nbest_fit |&gt;\n  extract_fit_parsnip() |&gt;\n  tidy()\n\n# A tibble: 30 × 5\n   term                                estimate std.error statistic  p.value\n   &lt;chr&gt;                                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;\n 1 (Intercept)                           15127.     2181.     6.93  3.97e-11\n 2 seasons_Spring                        -7314.     3715.    -1.97  5.02e- 2\n 3 seasons_Summer                        17027.     3515.     4.84  2.33e- 6\n 4 seasons_Winter                        -7739.     3180.    -2.43  1.57e- 2\n 5 holiday_No.Holiday                     6216.     2055.     3.03  2.77e- 3\n 6 day_of_week_weekend                   -2433.      392.    -6.21  2.47e- 9\n 7 holiday_No.Holiday_x_seasons_Spring    2520.     3752.     0.672 5.02e- 1\n 8 holiday_No.Holiday_x_seasons_Summer   -2849.     2881.    -0.989 3.24e- 1\n 9 holiday_No.Holiday_x_seasons_Winter   -3753.     2459.    -1.53  1.28e- 1\n10 seasons_Spring_x_mean_temperature_c    4524.     1115.     4.06  6.80e- 5\n# ℹ 20 more rows"
  }
]